/*
  Mr. Bennet was so odd a mixture of quick parts, sarcastic humour, reserve, and caprice, that the experience of three-and-twenty years had been insufficient to{5} make his wife understand his character. Her mind was less difficult to develope. She was a woman of mean understanding, little information, and uncertain temper. When she was discontented, she fancied herself nervous. The business of her life was to get her daughters married: its solace was visiting and news
*/

export const mk_level = () => {
  const txt = `


was so odd a mixture of quick parts, sarcastic humour, reserve, and caprice, that the experience of three-and-twenty years had been insufficient to{5} make his wife understand his character. Her mind was less diffic.lt to develope. She was a woman of mean understanding, little information, and uncertain temper.
                                                        u                           a                                      l                              f                       h
                                                        p                           n                                      o                              u                       i
An invitation to dinner was soon afterwards despatched; and already had Mrs. Bennet planned the courses that were to do credit to her housekeeping, when an answer arrived which deferred it all. Mr. Bingley was obliged to be in town the following day, and consequently unable to accept the honour of their invitation, etc.
     i                  i                                       n                                  u                                  h                                           h
     s                  n                                       i                                  p                                  u                                           i
When she was discontented, she fancied herself nervous. The business of her life was to get her daughters married: its solace was visiting and news. Indeed, sir, I have not the least intention of dancing. I entreat you not to suppose that I moved this way in order to beg for a partner.
                   u                   t                                    o                                          a                       h                                  h                   p
                   p                   o                                    f                                          n                       u                                  i                   o
it's not    Elizabeth was far from suspecting that she was herself becoming an object of some interest in the eyes of his friend. Mr. Darcy had at first scarcely allowed her to be pretty: he had looked at her without admiration at the ball; and when they next met, he looked at her only to criticise.
       u             g                                 y                                  n              o                             a                 f                        h
       p             o                                 o                                  m              l                             n                 u                        i
beyond the recesses of the I am all astonishment. How long has she been such a favourite? and pray when am I to wish you joy? which a pair of fine eyes in the face of a pretty woman can bestow. they repaired to her room on leaving the dining-parlour, and sat with her till summoned to coffee. She was still very poorly,


was so odd a mixture of quick parts, sarcastic humour, reserve, and caprice, that the experience of three-and-twenty years had been insufficient to{5} make his wife understand his character. Her mind was less diffic.lt to develope. She was a woman of mean understanding, little information, and uncertain temper.
                                                        u                           a                                      l                              f                       h
                                                        p                           n                                      o                              u                       i
An invitation to dinner was soon afterwards despatched; and already had Mrs. Bennet planned the courses that were to do credit to her housekeeping, when an answer arrived which deferred it all. Mr. Bingley was obliged to be in town the following day, and consequently unable to accept the honour of their invitation, etc.
     i                  i                                       n                                  u                                  h                                           h
     s                  n                                       i                                  p                                  u                                           i
When she was discontented, she fancied herself nervous. The business of her life was to get her daughters married: its solace was visiting and news. Indeed, sir, I have not the least intention of dancing. I entreat you not to suppose that I moved this way in order to beg for a partner.
                   u                   t                                    o                                          a                       h                                  h                   p
                   p                   o                                    f                                          n                       u                                  i                   o
it's not    Elizabeth was far from suspecting that she was herself becoming an object of some interest in the eyes of his friend. Mr. Darcy had at first scarcely allowed her to be pretty: he had looked at her without admiration at the ball; and when they next met, he looked at her only to criticise.
       u             g                                 y                                  n              o                             a                 f                        h
       p             o                                 o                                  m              l                             n                 u                        i
beyond the recesses of the I am all astonishment. How long has she been such a favourite? and pray when am I to wish you joy? which a pair of fine eyes in the face of a pretty woman can bestow. they repaired to her room on leaving the dining-parlour, and sat with her till summoned to coffee. She was still very poorly,


was so odd a mixture of quick parts, sarcastic humour, reserve, and caprice, that the experience of three-and-twenty years had been insufficient to{5} make his wife understand his character. Her mind was less diffic.lt to develope. She was a woman of mean understanding, little information, and uncertain temper.
                                                        u                           a                                      l                              f                       h
                                                        p                           n                                      o                              u                       i
An invitation to dinner was soon afterwards despatched; and already had Mrs. Bennet planned the courses that were to do credit to her housekeeping, when an answer arrived which deferred it all. Mr. Bingley was obliged to be in town the following day, and consequently unable to accept the honour of their invitation, etc.
     i                  i                                       n                                  u                                  h                                           h
     s                  n                                       i                                  p                                  u                                           i
When she was discontented, she fancied herself nervous. The business of her life was to get her daughters married: its solace was visiting and news. Indeed, sir, I have not the least intention of dancing. I entreat you not to suppose that I moved this way in order to beg for a partner.
                   u                   t                                    o                                          a                       h                                  h                   p
                   p                   o                                    f                                          n                       u                                  i                   o
it's not    Elizabeth was far from suspecting that she was herself becoming an object of some interest in the eyes of his friend. Mr. Darcy had at first scarcely allowed her to be pretty: he had looked at her without admiration at the ball; and when they next met, he looked at her only to criticise.
       u             g                                 y                                  n              o                             a                 f                        h
       p             o                                 o                                  m              l                             n                 u                        i
beyond the recesses of the I am all astonishment. How long has she been such a favourite? and pray when am I to wish you joy? which a pair of fine eyes in the face of a pretty woman can bestow. they repaired to her room on leaving the dining-parlour, and sat with her till summoned to coffee. She was still very poorly,


was so odd a mixture of quick parts, sarcastic humour, reserve, and caprice, that the experience of three-and-twenty years had been insufficient to{5} make his wife understand his character. Her mind was less diffic.lt to develope. She was a woman of mean understanding, little information, and uncertain temper.
                                                        u                           a                                      l                              f                       h
                                                        p                           n                                      o                              u                       i
An invitation to dinner was soon afterwards despatched; and already had Mrs. Bennet planned the courses that were to do credit to her housekeeping, when an answer arrived which deferred it all. Mr. Bingley was obliged to be in town the following day, and consequently unable to accept the honour of their invitation, etc.
     i                  i                                       n                                  u                                  h                                           h
     s                  n                                       i                                  p                                  u                                           i
When she was discontented, she fancied herself nervous. The business of her life was to get her daughters married: its solace was visiting and news. Indeed, sir, I have not the least intention of dancing. I entreat you not to suppose that I moved this way in order to beg for a partner.
                   u                   t                                    o                                          a                       h                                  h                   p
                   p                   o                                    f                                          n                       u                                  i                   o
it's not    Elizabeth was far from suspecting that she was herself becoming an object of some interest in the eyes of his friend. Mr. Darcy had at first scarcely allowed her to be pretty: he had looked at her without admiration at the ball; and when they next met, he looked at her only to criticise.
       u             g                                 y                                  n              o                             a                 f                        h
       p             o                                 o                                  m              l                             n                 u                        i
beyond the recesses of the I am all astonishment. How long has she been such a favourite? and pray when am I to wish you joy? which a pair of fine eyes in the face of a pretty woman can bestow. they repaired to her room on leaving the dining-parlour, and sat with her till summoned to coffee. She was still very poorly,


was so odd a mixture of quick parts, sarcastic humour, reserve, and caprice, that the experience of three-and-twenty years had been insufficient to{5} make his wife understand his character. Her mind was less diffic.lt to develope. She was a woman of mean understanding, little information, and uncertain temper.
                                                        u                           a                                      l                              f                       h
                                                        p                           n                                      o                              u                       i
An invitation to dinner was soon afterwards despatched; and already had Mrs. Bennet planned the courses that were to do credit to her housekeeping, when an answer arrived which deferred it all. Mr. Bingley was obliged to be in town the following day, and consequently unable to accept the honour of their invitation, etc.
     i                  i                                       n                                  u                                  h                                           h
     s                  n                                       i                                  p                                  u                                           i
When she was discontented, she fancied herself nervous. The business of her life was to get her daughters married: its solace was visiting and news. Indeed, sir, I have not the least intention of dancing. I entreat you not to suppose that I moved this way in order to beg for a partner.
                   u                   t                                    o                                          a                       h                                  h                   p
                   p                   o                                    f                                          n                       u                                  i                   o
it's not    Elizabeth was far from suspecting that she was herself becoming an object of some interest in the eyes of his friend. Mr. Darcy had at first scarcely allowed her to be pretty: he had looked at her without admiration at the ball; and when they next met, he looked at her only to criticise.
       u             g                                 y                                  n              o                             a                 f                        h
       p             o                                 o                                  m              l                             n                 u                        i
beyond the recesses of the I am all astonishment. How long has she been such a favourite? and pray when am I to wish you joy? which a pair of fine eyes in the face of a pretty woman can bestow. they repaired to her room on leaving the dining-parlour, and sat with her till summoned to coffee. She was still very poorly,


was so odd a mixture of quick parts, sarcastic humour, reserve, and caprice, that the experience of three-and-twenty years had been insufficient to{5} make his wife understand his character. Her mind was less diffic.lt to develope. She was a woman of mean understanding, little information, and uncertain temper.
                                                        u                           a                                      l                              f                       h
                                                        p                           n                                      o                              u                       i
An invitation to dinner was soon afterwards despatched; and already had Mrs. Bennet planned the courses that were to do credit to her housekeeping, when an answer arrived which deferred it all. Mr. Bingley was obliged to be in town the following day, and consequently unable to accept the honour of their invitation, etc.
     i                  i                                       n                                  u                                  h                                           h
     s                  n                                       i                                  p                                  u                                           i
When she was discontented, she fancied herself nervous. The business of her life was to get her daughters married: its solace was visiting and news. Indeed, sir, I have not the least intention of dancing. I entreat you not to suppose that I moved this way in order to beg for a partner.
                   u                   t                                    o                                          a                       h                                  h                   p
                   p                   o                                    f                                          n                       u                                  i                   o
it's not    Elizabeth was far from suspecting that she was herself becoming an object of some interest in the eyes of his friend. Mr. Darcy had at first scarcely allowed her to be pretty: he had looked at her without admiration at the ball; and when they next met, he looked at her only to criticise.
       u             g                                 y                                  n              o                             a                 f                        h
       p             o                                 o                                  m              l                             n                 u                        i
beyond the recesses of the I am all astonishment. How long has she been such a favourite? and pray when am I to wish you joy? which a pair of fine eyes in the face of a pretty woman can bestow. they repaired to her room on leaving the dining-parlour, and sat with her till summoned to coffee. She was still very poorly,

`;
  const raw = txt.split("\n").slice(1).slice(0, -1);
  const longest = raw.reduce((ac, el) => (el.length > ac ? el.length : ac), 0);
  const lines = raw.map((l) => l.padEnd(longest) + "x");
  console.log(lines);
  const chars = lines.map((l) => l.padEnd(longest).split(""));

  const indexes = lines.map((l) => {
    const words = l.split(" ");
    return words.reduce(
      (ac, el) => {
        const { words, i } = ac;
        const start = i;
        const word = el;
        const len = word.length;
        words.push({
          word,
          start,
          end: start + len,
        });
        return { words, i: start + len + 1 };
      },
      { words: [], i: 0 }
    );
  });

  const get_by_index = (x, y) => {
    const word = indexes[y].words.find(({ end }) => end >= x);
    return word;
  };

  const words = lines.map((l) =>
    l.split(" ").reduce((ac, el) => {
      ac.push(el);
      return ac;
    }, [])
  );

  const word_at_xy = (x, y) => {
    const token = get_by_index(x, y);
    if (!token) {
      console.log(x, y, indexes[y].words);
    }
    const word = token.word;
    const char_idx = x - token.start;
    const start = token.start;
    const end = token.end;
    return {
      word,
      char_idx,
      start,
      end,
      y,
    };
  };

  return {
    w: longest,
    h: lines.length,
    chars,
    words,
    word_at_xy,
  };
};
